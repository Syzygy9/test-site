language: node_js
node_js:
  - 12
before_install:
  # Before_install section
  - ignore
before_script:
  # Before_script section
  - ignore

env:
  global:
    - ANGULAR_SITE_FOLDER="angular-site"

stages:
  - prepare
  - compile
  - test
  - merge

jobs:
  include:
    - stage: prepare
      name: Prepare
      skip_cleanup: true
      script:
        - npm --version
        - cd $ANGULAR_SITE_FOLDER
        - npm install

    - stage: compile
      name: Compile
      skip_cleanup: true
      script:
        - cd $ANGULAR_SITE_FOLDER
        - ng build --prod

    - stage: test
      name: Run tests
      script:
        - echo "Test stage goes here, right now tests are considered passed by default"

    - stage: merge
      name: Merge the changes into jdi-light
      if: branch = travis-setup #should be 'master' in the future
      github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
      script:
        - sh travis_automerge_to_jdi_light.sh
after_failure:
  - echo "Build has failed"
after_script:
  #One can add some cleanup here
  - ignore
after_success:
  - echo "Build has succeded"